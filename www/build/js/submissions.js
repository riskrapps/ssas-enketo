!function(root,factory){if("object"==typeof exports&&"object"==typeof module)module.exports=factory();else if("function"==typeof define&&define.amd)define([],factory);else{var a=factory();for(var i in a)("object"==typeof exports?exports:root)[i]=a[i]}}(window,function(){return(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1:function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var UrlSearchParams=__webpack_require__(156),QueryParams=function(){function QueryParams(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,QueryParams)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(QueryParams,[{key:"urlParams",value:function(){return this._urlParams||(this._urlParams=new UrlSearchParams(window.location.search)),this._urlParams}},{key:"has",value:function(key){return this.urlParams().has(key)}},{key:"get",value:function(key){return this.urlParams().get(key)}},{key:"getUrl",value:function(uri){var url="";return this.has("base")&&(url=this.get("base")+"/"),url+uri}},{key:"getPath",value:function(key){return this.getUrl(this.get(key))}}]),QueryParams}();__webpack_exports__.a=new QueryParams},110:function(module,exports,__webpack_require__){window.$=window.jQuery=__webpack_require__(2)},111:function(module,exports,__webpack_require__){var en=__webpack_require__(112),lo=__webpack_require__(113),zh=__webpack_require__(114),_=__webpack_require__(82),Cookies_set=function(key,value){window.localStorage.setItem(key,value)},Cookies_get=function(key){return window.localStorage.getItem(key)},i18n={},languages={en:en,lo:lo,zh:zh},fallback=en;i18n.set=function(language){languages.hasOwnProperty(language)?(this.language=language,this.translations=languages[language],this.translateDocument(),Cookies_set("language",this.language)):console.error("Language not found: "+language)},i18n.get=function(){return this.language},i18n._=function(key,bindings){null==bindings&&(bindings={});var t=_.get(this.translations,key,_.get(fallback,key,""));for(var key in bindings)t=t.replace(new RegExp(":"+key,"g"),bindings[key]);return t},i18n.translateDocument=function(){for(var matches=document.querySelectorAll("[data-i18n]"),i=0;i<matches.length;i++){var el=matches[i],key=el.getAttribute("data-i18n"),translation=this._(key);el.innerHTML=translation}},document.onreadystatechange=function(){var language=Cookies_get("language");null==language&&(language="en"),i18n.set(language)},window.i18n=i18n,module.exports=i18n},112:function(module,exports){module.exports={index:{upload:"Upload"},survey:{loading:"Loading Survey!",wait:"This will take a few moments...",errors:"Form contains errors, please fix all errors before submitting.",saved:"Active session has been saved",camera:"Camera",save:"Save",validate:"Validate",first:"First",last:"Last",jump_to:"Jump To",submit:"Validate &amp; Submit",back:"Back",next:"Next"},session:{title:"Survey Session",description:"Start a New Session",name:"Name this Session",start:"Start"},constraint:{required:"This field is required.",invalid:"Value not allowed"},submissions:{back:"Back",upload_all:"Upload All",upload_single:"Upload This",title:"Upload Surveys",uploaded:"Uploaded!",name:"Name",hint:"Hint",size:"Size",created_at:"Created At",error:"An error occured while trying to submit packet named :packet",success:"Packet named :packet has been submitted!"}}},113:function(module,exports){module.exports={index:{upload:"ອັບໂຫລດ"},survey:{loading:"ກໍາລັງໂຫລດ",wait:"ລໍຖ້າ",errors:"ຜິດພາດ",saved:"ບັນທຶກໄວ້ແລ້ວ",camera:"ກ້ອງຖ່າຍຮູບ",save:"ບັນທຶກ",validate:"ກວດສອບ",first:"ຫນ້າທໍາອິດ",last:"ໜ້າສຸດທ້າຍ",jump_to:"ຄົ້ນຫາ",submit:"ສົ່ງຂໍ້ມູນ",back:"ກັບຄືນໄປບ່ອນເກົ່າ",next:"ຕໍ່ໄປ"},session:{title:"ຫົວຂໍ້",description:"ລາຍລະອຽດ",name:"ຊື່",start:"ເລີ່ມຕົ້ນ"},constraint:{required:"ຕ້ອງການ",invalid:"ບໍ່ຖືກຕ້ອງ"},submissions:{back:"Back",upload_all:"ອັບໂຫລດທັງຫມົດ",upload_single:"ອັບໂຫລດ",title:"ຢູ່ລະຫວ່າງການສົ່ງຂໍ້ມູນ",uploaded:"ອັບ!",name:"ຊື່",hint:"Hint",size:"ຂະຫນາດ",created_at:"ປະດິດສ້າງຂື້ນໃນ",error:"ຜິດພາດ :packet",success:"ສໍາເລັດ :packet ຊຸດ"}}},114:function(module,exports){module.exports={index:{upload:"上传"},survey:{loading:"加载问卷！",wait:"需要一些时间...",errors:"表单包含错误，请在提交之前修复所有错误。",saved:"已保存操作",camera:"相机",save:"保存",validate:"确认",first:"首页",last:"末页",search:"搜索",submit:"确认并提交",back:"返回",next:"下一页"},session:{title:"问卷调查会话",description:"开始一个新的会话",name:"会话命名",start:"开始"},constraint:{required:"此字段必填.",invalid:"值不可用"},submissions:{upload_all:"上传所有",upload_single:"上传此次数据",title:"申请数据提交",uploaded:"上传完成！",name:"名称",hint:"提示",size:"大小",created_at:"创建于",error:"试图提交名为:packet的数据包时出错。",success:"包名:packet已提交！"}}},22:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Session});var _QueryParams__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Session=function(){function Session(data){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Session),this.data=_objectSpread({xml:null,online:!1,draft:!0,payload:{},_attachments:{},submitted:!1,instance_id:null,deprecated_id:null,last_update:Date.now()},data),data.hasOwnProperty("payload")||this._setPayloadFromUrl()}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Session,[{key:"setData",value:function(data){return this.data=_objectSpread({},this.data,data,{last_update:Date.now()}),this}},{key:"_setPayloadFromUrl",value:function(){try{var sessionExtra=_QueryParams__WEBPACK_IMPORTED_MODULE_0__.a.get("session_extra");this.setData({payload:JSON.parse(sessionExtra)})}catch(e){console.error(e)}}},{key:"putEnketoForm",value:function(form){this.setData({xml:form.xml,instance_id:form.instance_id,deprecated_id:form.deprecated_id,_attachments:this._getFiles(form.files)})}},{key:"toFormInstance",value:function(){return{instanceStr:this.data.xml,submitted:this.data.submitted}}},{key:"isOnline",value:function(){return this.data.online}},{key:"_getFiles",value:function(files){var _this=this;if(!files||"object"!==_typeof(files))return this.data._attachments;var attachments={};return files.forEach(function(file){_this._isFileStub(file)?_this._attachmentExists(file)&&(attachments[file]=_objectSpread({},_this.data._attachments[file],{stub:!0})):attachments[file.name]={data:file,content_type:file.type}}),attachments}},{key:"_isFileStub",value:function(file){return"string"==typeof file}},{key:"_attachmentExists",value:function(name){return this.data.hasOwnProperty("_attachments")&&this.data._attachments.hasOwnProperty(name)}}]),Session}()},23:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var index_browser=__webpack_require__(62),index_browser_default=__webpack_require__.n(index_browser);window.PouchDB=index_browser_default.a;var instances={};function Storage(dbName){var driver=function(name){return new index_browser_default.a(name,{revs_limit:1,auto_compaction:!0})}(dbName);this.all=function(){return driver.allDocs({include_docs:!0}).then(function(result){return result.rows.map(function(row){return row.doc})})},this.create=function(doc){return driver.post(doc).then(function(result){return driver.get(result.id)})},this.update=function(doc){return driver.put(doc).then(function(result){return driver.get(result.id)})},this.get=function(id){return driver.get(id)},this.remove=function(doc){return driver.remove(doc)},this.attach=function(id,attachmentId,blob){return driver.putAttachment(id,attachmentId,blob)},this.getAttachment=function(id,filename){return driver.getAttachment(id,filename)}}var QueryParams=__webpack_require__(1),databaseName="sessions";QueryParams.a.has("db")&&(databaseName=QueryParams.a.get("db"));var name;__webpack_exports__.default=(name=databaseName,instances.hasOwnProperty(name)||(instances[name]=new Storage(name)),instances[name])},37:function(module,__webpack_exports__,__webpack_require__){"use strict";var axios=__webpack_require__(45),axios_default=__webpack_require__.n(axios);function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var common_Cookies=new(function(){function Cookies(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Cookies)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Cookies,[{key:"get",value:function(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}}]),Cookies}()),QueryParams=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Server_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,"a",function(){return Server_Server});var serverInstance=null,Server_Server=function(){function Server(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Server),this._configureAxios()}var _postForm,_json;return function(Constructor,protoProps,staticProps){protoProps&&Server_defineProperties(Constructor.prototype,protoProps),staticProps&&Server_defineProperties(Constructor,staticProps)}(Server,[{key:"_configureAxios",value:function(){var token=this._detectAuthToken();null!==token&&(axios_default.a.defaults.headers.common.Authorization="Bearer "+token)}},{key:"_detectAuthToken",value:function(){return QueryParams.a.has("auth")?QueryParams.a.get("auth"):common_Cookies.get("enketo_token")?common_Cookies.get("enketo_token"):null}},{key:"json",value:(_json=_asyncToGenerator(regeneratorRuntime.mark(function _callee(url){var _ref,data;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,axios_default.a.get(url);case 2:return _ref=_context.sent,data=_ref.data,_context.abrupt("return",data);case 5:case"end":return _context.stop()}},_callee,this)})),function(_x){return _json.apply(this,arguments)})},{key:"postForm",value:(_postForm=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session){var onProgress,form,submitUrl,config,_ref2,data,_args2=arguments;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return onProgress=1<_args2.length&&void 0!==_args2[1]?_args2[1]:null,(form=new FormData).append("Date",(new Date).toUTCString()),form.append("xml_submission_file",new Blob([session.data.xml])),"object"===_typeof(session.data.payload)&&form.append("Payload",JSON.stringify(session.data.payload)),submitUrl=QueryParams.a.getPath("submit"),config={headers:this._headersForSession(session)},onProgress&&(config.onUploadProgress=function(progressEvent){return onProgress(0<progressEvent.total?progressEvent.loaded/progressEvent.total:0)}),_context2.next=10,axios_default.a.post(submitUrl,form,config);case 10:return _ref2=_context2.sent,data=_ref2.data,_context2.abrupt("return",data);case 13:case"end":return _context2.stop()}},_callee2,this)})),function(_x2){return _postForm.apply(this,arguments)})},{key:"_headersForSession",value:function(session){return{"Content-Type":"multipart/form-data","X-OpenRosa-Version":"1.0","X-OpenRosa-Instance-Id":session.data.instance_id,"X-OpenRosa-Deprecated-Id":session.data.deprecated_id}}}],[{key:"create",value:function(){return serverInstance||(serverInstance=Server.newInstance()),serverInstance}},{key:"newInstance",value:function(){return new Server}}]),Server}()},468:function(module,exports,__webpack_require__){},471:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(110),__webpack_require__(468),__webpack_require__(111),__webpack_require__(44);var toastr=__webpack_require__(38),toastr_default=__webpack_require__.n(toastr),Server=__webpack_require__(37),Session=__webpack_require__(22),SessionRepository=__webpack_require__(23),app=angular.module("app",[]);app.filter("fileSize",function(){return function(bytes){if(0==bytes)return"0 Byte";var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1024)));return Math.round(bytes/Math.pow(1024,i),2)+" "+["Bytes","KB","MB","GB","TB"][i]}}),app.filter("date",function(){return function(value){return new Date(value).toLocaleString()}}),app.directive("progress",function(){return{scope:{value:"="},restrict:"E",replace:!0,template:'<div class="progress"> <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="100" style="width: {{value}}%"> <span class="sr-only">{{value}}% Complete (success)</span> </div> </div>'}}),app.controller("SubmissionsCtrl",["$scope","$timeout",function($scope,$timeout){function loadPackets(showSubmitted){return SessionRepository.default.all().then(function(sessions){$scope.packets=sessions.filter(function(session){return showSubmitted?!session.draft:!session.draft&&!session.submitted}).map(function(session){var xmlSize=2*session.xml.length;return session.size=Object.values(session._attachments).reduce(function(total,attachment){return total+attachment.length},xmlSize),session}),$scope.$apply()})}loadPackets(!1),$scope.revealAll=function(){loadPackets(!0).then(function(){$scope.packets.length||alert("No submitted packets were found..."),document.querySelector(".reveal-all").remove()})},$scope.uploadAll=function(){angular.forEach($scope.packets,function(packet){$scope.upload(packet)})},$scope.remove=function(packet){$timeout(function(){var index=$scope.packets.indexOf(packet);0<=index&&$scope.packets.splice(index,1)})},$scope.upload=function(packet){$timeout(function(){if(!packet.uploading){packet.uploading=!0,packet.progress=0;Server.a.create().postForm(new Session.a(packet),function(progress){$timeout(function(){packet.progress=100*progress})}).then(function(){return SessionRepository.default.get(packet._id)}).then(function(session){return session.submitted=!0,SessionRepository.default.update(session)}).then(function(){toastr_default.a.success(i18n._("submissions.success",{packet:packet.name})),$scope.remove(packet)}).catch(function(err){console.error(err),packet.uploading=!1,packet.uploaded=!1,$scope.$apply(),toastr_default.a.error(i18n._("submissions.error",{packet:packet.name}))})}})}}])},82:function(module,exports,__webpack_require__){var lodashSet=__webpack_require__(155);module.exports={get:function(obj,path,def){return path.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean).every(function(step){return!(step&&void 0===(obj=obj[step]))})?obj:def},set:lodashSet}}},[[471,1,0]]])});