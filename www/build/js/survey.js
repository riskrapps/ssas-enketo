!function(root,factory){if("object"==typeof exports&&"object"==typeof module)module.exports=factory();else if("function"==typeof define&&define.amd)define([],factory);else{var a=factory();for(var i in a)("object"==typeof exports?exports:root)[i]=a[i]}}(window,function(){return(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1:function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var UrlSearchParams=__webpack_require__(156),QueryParams=function(){function QueryParams(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,QueryParams)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(QueryParams,[{key:"urlParams",value:function(){return this._urlParams||(this._urlParams=new UrlSearchParams(window.location.search)),this._urlParams}},{key:"has",value:function(key){return this.urlParams().has(key)}},{key:"get",value:function(key){return this.urlParams().get(key)}},{key:"getUrl",value:function(uri){var url="";return this.has("base")&&(url=this.get("base")+"/"),url+uri}},{key:"getPath",value:function(key){return this.getUrl(this.get(key))}}]),QueryParams}();__webpack_exports__.a=new QueryParams},110:function(module,exports,__webpack_require__){window.$=window.jQuery=__webpack_require__(2)},111:function(module,exports,__webpack_require__){var en=__webpack_require__(112),lo=__webpack_require__(113),zh=__webpack_require__(114),_=__webpack_require__(82),Cookies_set=function(key,value){window.localStorage.setItem(key,value)},Cookies_get=function(key){return window.localStorage.getItem(key)},i18n={},languages={en:en,lo:lo,zh:zh},fallback=en;i18n.set=function(language){languages.hasOwnProperty(language)?(this.language=language,this.translations=languages[language],this.translateDocument(),Cookies_set("language",this.language)):console.error("Language not found: "+language)},i18n.get=function(){return this.language},i18n._=function(key,bindings){void 0==bindings&&(bindings={});var t=_.get(this.translations,key,_.get(fallback,key,""));for(var key in bindings)t=t.replace(new RegExp(":"+key,"g"),bindings[key]);return t},i18n.translateDocument=function(){for(var matches=document.querySelectorAll("[data-i18n]"),i=0;i<matches.length;i++){var el=matches[i],key=el.getAttribute("data-i18n"),translation=this._(key);el.innerHTML=translation}},document.onreadystatechange=function(){var language=Cookies_get("language");void 0==language&&(language="en"),i18n.set(language)},window.i18n=i18n,module.exports=i18n},112:function(module,exports){module.exports={index:{upload:"Upload"},survey:{loading:"Loading Survey!",wait:"This will take a few moments...",errors:"Form contains errors, please fix all errors before submitting.",saved:"Active session has been saved",camera:"Camera",save:"Save",validate:"Validate",first:"First",last:"Last",jump_to:"Jump To",submit:"Validate &amp; Submit",back:"Back",next:"Next"},session:{title:"Survey Session",description:"Start a New Session",name:"Name this Session",start:"Start"},constraint:{required:"This field is required.",invalid:"Value not allowed"},submissions:{back:"Back",upload_all:"Upload All",upload_single:"Upload This",title:"Upload Surveys",uploaded:"Uploaded!",name:"Name",hint:"Hint",size:"Size",created_at:"Created At",error:"An error occured while trying to submit packet named :packet",success:"Packet named :packet has been submitted!"}}},113:function(module,exports){module.exports={index:{upload:"ອັບໂຫລດ"},survey:{loading:"ກໍາລັງໂຫລດ",wait:"ລໍຖ້າ",errors:"ຜິດພາດ",saved:"ບັນທຶກໄວ້ແລ້ວ",camera:"ກ້ອງຖ່າຍຮູບ",save:"ບັນທຶກ",validate:"ກວດສອບ",first:"ຫນ້າທໍາອິດ",last:"ໜ້າສຸດທ້າຍ",jump_to:"ຄົ້ນຫາ",submit:"ສົ່ງຂໍ້ມູນ",back:"ກັບຄືນໄປບ່ອນເກົ່າ",next:"ຕໍ່ໄປ"},session:{title:"ຫົວຂໍ້",description:"ລາຍລະອຽດ",name:"ຊື່",start:"ເລີ່ມຕົ້ນ"},constraint:{required:"ຕ້ອງການ",invalid:"ບໍ່ຖືກຕ້ອງ"},submissions:{back:"Back",upload_all:"ອັບໂຫລດທັງຫມົດ",upload_single:"ອັບໂຫລດ",title:"ຢູ່ລະຫວ່າງການສົ່ງຂໍ້ມູນ",uploaded:"ອັບ!",name:"ຊື່",hint:"Hint",size:"ຂະຫນາດ",created_at:"ປະດິດສ້າງຂື້ນໃນ",error:"ຜິດພາດ :packet",success:"ສໍາເລັດ :packet ຊຸດ"}}},114:function(module,exports){module.exports={index:{upload:"上传"},survey:{loading:"加载问卷！",wait:"需要一些时间...",errors:"表单包含错误，请在提交之前修复所有错误。",saved:"已保存操作",camera:"相机",save:"保存",validate:"确认",first:"首页",last:"末页",search:"搜索",submit:"确认并提交",back:"返回",next:"下一页"},session:{title:"问卷调查会话",description:"开始一个新的会话",name:"会话命名",start:"开始"},constraint:{required:"此字段必填.",invalid:"值不可用"},submissions:{upload_all:"上传所有",upload_single:"上传此次数据",title:"申请数据提交",uploaded:"上传完成！",name:"名称",hint:"提示",size:"大小",created_at:"创建于",error:"试图提交名为:packet的数据包时出错。",success:"包名:packet已提交！"}}},22:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Session});var _QueryParams__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Session=function(){function Session(data){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Session),this.data=_objectSpread({xml:null,online:!1,draft:!0,payload:{},_attachments:{},submitted:!1,instance_id:null,deprecated_id:null,last_update:Date.now()},data),data.hasOwnProperty("payload")||this._setPayloadFromUrl()}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Session,[{key:"setData",value:function(data){return this.data=_objectSpread({},this.data,data,{last_update:Date.now()}),this}},{key:"_setPayloadFromUrl",value:function(){try{var sessionExtra=_QueryParams__WEBPACK_IMPORTED_MODULE_0__.a.get("session_extra");this.setData({payload:JSON.parse(sessionExtra)})}catch(e){console.error(e)}}},{key:"writeEnketoForm",value:function(form){this.setData({xml:form.xml,instance_id:form.instance_id,deprecated_id:form.deprecated_id,_attachments:this._getFiles(form.files)})}},{key:"toFormInstance",value:function(){return{instanceStr:this.data.xml,submitted:this.data.submitted}}},{key:"isOnline",value:function(){return this.data.online}},{key:"_getFiles",value:function(files){var _this=this;if(!files||"object"!==_typeof(files))return this.data._attachments;var attachments={};return files.forEach(function(file){_this._isFileStub(file)?_this._attachmentExists(file)&&(attachments[file]=_objectSpread({},_this.data._attachments[file],{stub:!0})):attachments[file.name]={data:file,content_type:file.type}}),attachments}},{key:"_isFileStub",value:function(file){return"string"==typeof file}},{key:"_attachmentExists",value:function(name){return this.data.hasOwnProperty("_attachments")&&this.data._attachments.hasOwnProperty(name)}}]),Session}()},27:function(module,__webpack_exports__,__webpack_require__){"use strict";var index_browser=__webpack_require__(62),index_browser_default=__webpack_require__.n(index_browser);window.PouchDB=index_browser_default.a;var instances={};function Storage(dbName){var driver=function(name){return new index_browser_default.a(name,{revs_limit:1,auto_compaction:!0})}(dbName);this.all=function(){return driver.allDocs({include_docs:!0}).then(function(result){return result.rows.map(function(row){return row.doc})})},this.create=function(doc){return driver.post(doc).then(function(result){return driver.get(result.id)})},this.update=function(doc){return driver.put(doc).then(function(result){return driver.get(result.id)})},this.get=function(id){return driver.get(id)},this.remove=function(doc){return driver.remove(doc)},this.attach=function(id,attachmentId,blob){return driver.putAttachment(id,attachmentId,blob)},this.getAttachment=function(id,filename){return driver.getAttachment(id,filename)}}var QueryParams=__webpack_require__(1),databaseName="sessions";QueryParams.a.has("db")&&(databaseName=QueryParams.a.get("db"));__webpack_exports__.a=function(name){return instances.hasOwnProperty(name)||(instances[name]=new Storage(name)),instances[name]}(databaseName)},37:function(module,__webpack_exports__,__webpack_require__){"use strict";var axios=__webpack_require__(45),axios_default=__webpack_require__.n(axios);function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var common_Cookies=new(function(){function Cookies(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Cookies)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Cookies,[{key:"get",value:function(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}}]),Cookies}()),QueryParams=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Server_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,"a",function(){return Server_Server});var serverInstance=null,Server_Server=function(){function Server(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Server),this._configureAxios()}return function(Constructor,protoProps,staticProps){protoProps&&Server_defineProperties(Constructor.prototype,protoProps),staticProps&&Server_defineProperties(Constructor,staticProps)}(Server,[{key:"_configureAxios",value:function(){var token=this._detectAuthToken();null!==token&&(axios_default.a.defaults.headers.common.Authorization="Bearer "+token)}},{key:"_detectAuthToken",value:function(){return QueryParams.a.has("auth")?QueryParams.a.get("auth"):common_Cookies.get("enketo_token")?common_Cookies.get("enketo_token"):null}},{key:"json",value:function(){var _json=_asyncToGenerator(regeneratorRuntime.mark(function _callee(url){var _ref,data;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,axios_default.a.get(url);case 2:return _ref=_context.sent,data=_ref.data,_context.abrupt("return",data);case 5:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _json.apply(this,arguments)}}()},{key:"postForm",value:function(){var _postForm=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session){var onProgress,form,submitUrl,config,_ref2,data,_args2=arguments;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return onProgress=_args2.length>1&&void 0!==_args2[1]?_args2[1]:null,(form=new FormData).append("Date",(new Date).toUTCString()),form.append("xml_submission_file",new Blob([session.data.xml])),"object"===_typeof(session.data.payload)&&form.append("Payload",JSON.stringify(session.data.payload)),submitUrl=QueryParams.a.getPath("submit"),config={headers:this._headersForSession(session)},onProgress&&(config.onUploadProgress=function(progressEvent){return onProgress(progressEvent.total>0?progressEvent.loaded/progressEvent.total:0)}),_context2.next=10,axios_default.a.post(submitUrl,form,config);case 10:return _ref2=_context2.sent,data=_ref2.data,_context2.abrupt("return",data);case 13:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2){return _postForm.apply(this,arguments)}}()},{key:"_headersForSession",value:function(session){return{"Content-Type":"multipart/form-data","X-OpenRosa-Version":"1.0","X-OpenRosa-Instance-Id":session.data.instance_id,"X-OpenRosa-Deprecated-Id":session.data.deprecated_id}}}],[{key:"create",value:function(){return serverInstance||(serverInstance=Server.newInstance()),serverInstance}},{key:"newInstance",value:function(){return new Server}}]),Server}()},373:function(module,exports,__webpack_require__){},375:function(module,exports){!function(){var $body=$("body");$.fn.overlay=$.fn.overlay=function(action){switch(action){case"show":!function($el){$(window).scrollTop(0),setTimeout(function(){$body.addClass("noScroll"),$el.show()})}(this);break;case"hide":!function($el){$body.removeClass("noScroll"),$el.hide()}(this);break;default:throw new Exception("Unknown action. Either use show or hide.")}return this}}()},381:function(module,exports,__webpack_require__){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var FormModel=__webpack_require__(157),parser=new DOMParser;FormModel.prototype.createSession=function(id,sessObj){var instance,session,model=this.xml.querySelector("model");model&&(sessObj="object"===_typeof(sessObj)?sessObj:{},(instance=model.querySelector('instance[id="'+id+'"]'))||(instance=parser.parseFromString('<instance id="'+id+'"/>',"text/xml").documentElement,this.xml.adoptNode(instance),model.appendChild(instance)),Object.keys(sessObj).forEach(function(prop){sessObj[prop]=sessObj[prop]||utils.readCookie("__enketo_meta_"+prop)||prop+" not found"}),session=parser.parseFromString("<session><context>"+Object.keys(sessObj).map(function(prop){return"<"+prop+">"+sessObj[prop]+"</"+prop+">"}).join("")+"</context></session>","text/xml").documentElement,this.xml.adoptNode(session),instance.appendChild(session))},module.exports=FormModel},466:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(110),__webpack_require__(373),__webpack_require__(111),__webpack_require__(375);var toastr=__webpack_require__(38),toastr_default=__webpack_require__.n(toastr),angular=__webpack_require__(44),angular_default=__webpack_require__.n(angular),QueryParams=(__webpack_require__(378),__webpack_require__(1)),emitter=__webpack_require__(42);!function(){if($("#jump-to-block").hide(),"off"!==QueryParams.a.get("jumpto")){var app=angular_default.a.module("jumpTo",["vAccordion"]),_=__webpack_require__(82);app.controller("jumpCtrl",["$scope",function($scope){var rawPages=[];$scope.pages={},$scope.search={label:""},emitter.on("EnketoForm.initialized",function(){return $scope.$apply(function(){$('[role="page"]').each(function(){var page=$(this);$(".question-label.active",page).each(function(){var label=$(this).text();if(!(label.length<2||"."!=label[1])){var firstSpace=label.indexOf(" "),notations=label.substr(0,firstSpace).split(".").filter(function(str){return""!=str});rawPages.push({el:page.children().first(),notations:notations,label:label})}})}),rawPages.forEach(function(page){if(_.set($scope.pages,page.notations.join(".items."),page),page.notations.length>1){page.notations.pop();var parentPage=page.notations.join(".items.");null==_.get($scope.pages,parentPage+".label",null)&&(_.set($scope.pages,parentPage+".label",page.label),_.set($scope.pages,parentPage+".el",page.el))}})})}),$scope.jump=function(page){$scope.accordion.collapseAll(),form.pages.flipToPageContaining(page.el),setTimeout(function(){$("#jump-to-block").overlay("hide")})},$("#jump-to-close").click(function(){$scope.accordion.collapseAll(),$("#jump-to-block").overlay("hide")})}]),$("#jump-to").click(function(){$("#jump-to-block").overlay("show")}),angular_default.a.bootstrap(document.getElementById("jump-to-block"),["jumpTo"])}else $("#jump-to").remove()}();__webpack_require__(381);var Server=__webpack_require__(37),Session=__webpack_require__(22);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var Sms_emitter=__webpack_require__(42),Sms_Sms=function(){function Sms(session){_classCallCheck(this,Sms),this.session=session}return _createClass(Sms,[{key:"transcode",value:function(xml){return new EnketoXmlParser(xml).parse()}},{key:"objectToText",value:function(object){return Object.keys(object).map(function(key){return"".concat(key,":").concat(object[key])}).join(";")}},{key:"submit",value:function(){var _submit=function(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(){var number,output,smsLink;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return number=QueryParams.a.get("sms"),output=_objectSpread({},"object"===_typeof(this.session.data.payload)?this.session.data.payload:{},this.transcode(this.session.data.xml)),smsLink=this._smsLink(number,this.objectToText(output)),window.clickSendSms=function(){Sms_emitter.emit("SMS.click")},Sms_emitter.emit("EnketoForm.submit.status",'<a href="'+smsLink+'" class="btn btn-primary" id="instantSubmit__sms-send" target="_blank" onclick="clickSendSms()">Click here to send SMS</a>'),_context.abrupt("return",new Promise(function(resolve){Sms_emitter.once("SMS.click",function(){setTimeout(resolve,200)})}));case 6:case"end":return _context.stop()}},_callee,this)}));return function(){return _submit.apply(this,arguments)}}()},{key:"_smsLink",value:function(number,body){var sms="sms:"+encodeURIComponent(number);return this._isPlatformApple()?sms+"&body="+encodeURIComponent(body):sms+"?body="+encodeURIComponent(body)}},{key:"_isPlatformApple",value:function(){var userAgent=window.navigator.userAgent.toLowerCase();return/iphone|ipod|ipad|os\sx/.test(userAgent)}}]),Sms}(),IGNORED_TAGS=["meta","start","end","today","username","simserial","subscriberid","deviceid","phonenumber"],EnketoXmlParser=function(){function EnketoXmlParser(xml){_classCallCheck(this,EnketoXmlParser),this.$xml=$($.parseXML(xml)),this.output={}}return _createClass(EnketoXmlParser,[{key:"parse",value:function(){return this._appendMeta(),this._appendFromNodes(this.$xml.find("data").children()),this.output}},{key:"_appendMeta",value:function(){var meta=this.$xml.find("meta");this._appendFromNodes(meta.children())}},{key:"_appendFromNodes",value:function($children){var _this=this;$children.each(function(){if($(this).children().length)return _this._appendFromNodes($(this).children());var node=$(this)[0];IGNORED_TAGS.includes(node.nodeName)||"file"!==node.getAttribute("type")&&node.textContent&&(_this.output[node.nodeName]=node.textContent)})}}]),EnketoXmlParser}();function Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Http_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Http_Http=function(){function Http(session){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Http),this.session=session}return function(Constructor,protoProps,staticProps){protoProps&&Http_defineProperties(Constructor.prototype,protoProps),staticProps&&Http_defineProperties(Constructor,staticProps)}(Http,[{key:"submit",value:function(){var _submit=function(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Server.a.create().postForm(this.session);case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}},_callee,this)}));return function(){return _submit.apply(this,arguments)}}()}]),Http}();function Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Submit_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Submit_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Submit_emitter=__webpack_require__(42),Submit_Submission=function(){function Submission(session){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Submission),this.session=session}return function(Constructor,protoProps,staticProps){protoProps&&Submit_defineProperties(Constructor.prototype,protoProps),staticProps&&Submit_defineProperties(Constructor,staticProps)}(Submission,[{key:"getDriver",value:function(){return QueryParams.a.has("sms")?new Sms_Sms(this.session):new Http_Http(this.session)}},{key:"chooseDriver",value:function(){var _chooseDriver=Submit_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this=this;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return window.chooseMethod=function(method){Submit_emitter.emit("Submit.method.choose",method)},Submit_emitter.emit("EnketoForm.submit.status",'<div style="text-align:center">Please choose submission method <br><a href="#" id="instantSubmit__sms" role="button" style="margin:16px" onclick="chooseMethod(\'sms\')" class="btn btn-primary">SMS</a><a href="#" id="instantSubmit__http" role="button" style="margin:16px" onclick="chooseMethod(\'http\')" class="btn btn-primary">Internet</a></div>'),_context.abrupt("return",new Promise(function(resolve){Submit_emitter.once("Submit.method.choose",function(method){return Submit_emitter.emit("EnketoForm.submit.status","Please wait..."),resolve("sms"===method?new Sms_Sms(_this.session):new Http_Http(_this.session))})}));case 3:case"end":return _context.stop()}},_callee,this)}));return function(){return _chooseDriver.apply(this,arguments)}}()},{key:"send",value:function(){var _send=Submit_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var driver;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(Submit_emitter.emit("EnketoForm.submitting"),!QueryParams.a.get("instant_submit")){_context2.next=7;break}return _context2.next=4,this.chooseDriver();case 4:driver=_context2.sent,_context2.next=8;break;case 7:driver=this.getDriver();case 8:return _context2.next=10,driver.submit();case 10:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _send.apply(this,arguments)}}()},{key:"_updateStatus",value:function(text){Submit_emitter.emit("EnketoForm.submit.status",text)}}]),Submission}(),Submit=function(session){return new Submit_Submission(session).send()};function Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Online_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Online_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Online_Online=function(){function Online(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Online)}return function(Constructor,protoProps,staticProps){protoProps&&Online_defineProperties(Constructor.prototype,protoProps),staticProps&&Online_defineProperties(Constructor,staticProps)}(Online,[{key:"start",value:function(){return QueryParams.a.has("edit")?this._loadSessionFromUrl(QueryParams.a.getPath("edit")):Promise.resolve(new Session.a({online:!0,draft:!1}))}},{key:"canSave",value:function(){return!1}},{key:"finalize",value:function(){var _finalize=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee(session){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Submit(session);case 2:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _finalize.apply(this,arguments)}}()},{key:"attachmentUrl",value:function(){var _attachmentUrl=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session,fileName){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",QueryParams.a.getUrl("submissions/"+session.data.instance_id+"/photo/"+fileName));case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2,_x3){return _attachmentUrl.apply(this,arguments)}}()},{key:"_loadSessionFromUrl",value:function(){var _loadSessionFromUrl2=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee3(url){var data;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Server.a.create().json(url);case 2:return data=_context3.sent,_context3.abrupt("return",new Session.a({submitted:!0,xml:data.instance,instance_id:data.instance_id,deprecated_id:data.deprecated_id}));case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(_x4){return _loadSessionFromUrl2.apply(this,arguments)}}()}]),Online}(),SessionRepository=__webpack_require__(27);function Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Offline_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Offline_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Offline_emitter=__webpack_require__(42),AVAILABLE_DRIVERS={online:Online_Online,offline:function(){function Offline(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Offline)}return function(Constructor,protoProps,staticProps){protoProps&&Offline_defineProperties(Constructor.prototype,protoProps),staticProps&&Offline_defineProperties(Constructor,staticProps)}(Offline,[{key:"start",value:function(){var _start=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this._loadSessions();case 2:return _context.abrupt("return",this._chooseSession());case 3:case"end":return _context.stop()}},_callee,this)}));return function(){return _start.apply(this,arguments)}}()},{key:"canSave",value:function(){return!0}},{key:"save",value:function(){var _save=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.t0=Session.a,_context2.next=3,SessionRepository.a.update(session.data);case 3:return _context2.t1=_context2.sent,_context2.abrupt("return",new _context2.t0(_context2.t1));case 5:case"end":return _context2.stop()}},_callee2,this)}));return function(_x){return _save.apply(this,arguments)}}()},{key:"finalize",value:function(){var _finalize=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee3(session){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!QueryParams.a.has("instant_submit")){_context3.next=4;break}return _context3.next=3,Submit(session);case 3:return _context3.abrupt("return",_context3.sent);case 4:return _context3.next=6,this.save(session.setData({draft:!1}));case 6:return _context3.abrupt("return",_context3.sent);case 7:case"end":return _context3.stop()}},_callee3,this)}));return function(_x2){return _finalize.apply(this,arguments)}}()},{key:"attachmentUrl",value:function(){var _attachmentUrl=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee4(session,fileName){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",SessionRepository.a.getAttachment(session.data._id,fileName).then(function(f){return URL.createObjectURL(f)}));case 1:case"end":return _context4.stop()}},_callee4,this)}));return function(_x3,_x4){return _attachmentUrl.apply(this,arguments)}}()},{key:"_loadSessions",value:function(){var _loadSessions2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var listedSessions;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,SessionRepository.a.all();case 2:this.sessions=_context5.sent,listedSessions=this.sessions.filter(function(s){return s.draft}).reverse(),Offline_emitter.emit("SessionModal.updateSessions",listedSessions);case 5:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _loadSessions2.apply(this,arguments)}}()},{key:"_chooseSession",value:function(){var _chooseSession2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!QueryParams.a.has("session")){_context6.next=2;break}return _context6.abrupt("return",this._startFromName(QueryParams.a.get("session")));case 2:return _context6.abrupt("return",this._sessionFromUi());case 3:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _chooseSession2.apply(this,arguments)}}()},{key:"_sessionFromUi",value:function(){var _sessionFromUi2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var _this=this;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return Offline_emitter.emit("SessionModal.activate"),_context8.abrupt("return",new Promise(function(resolve){Offline_emitter.once("Session.create",function(name){resolve(_this._createDistinctFromName(name))}),Offline_emitter.on("Session.delete",function(){var _ref=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee7(session){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,SessionRepository.a.remove(session);case 2:return _context7.next=4,_this._loadSessions();case 4:case"end":return _context7.stop()}},_callee7,this)}));return function(_x5){return _ref.apply(this,arguments)}}()),Offline_emitter.on("Session.select",function(session){resolve(new Session.a(session))})}));case 2:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _sessionFromUi2.apply(this,arguments)}}()},{key:"_startFromName",value:function(){var _startFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee9(name){var existingSession;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(!(existingSession=this.sessions.find(function(s){return s.name==name}))){_context9.next=3;break}return _context9.abrupt("return",new Session.a(existingSession));case 3:return _context9.abrupt("return",this._createFromName(name));case 4:case"end":return _context9.stop()}},_callee9,this)}));return function(_x6){return _startFromName2.apply(this,arguments)}}()},{key:"_create",value:function(){var _create2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee10(data){var session,savedSessionData;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return session=new Session.a(data),_context10.next=3,SessionRepository.a.create(session.data);case 3:return savedSessionData=_context10.sent,_context10.abrupt("return",new Session.a(savedSessionData));case 5:case"end":return _context10.stop()}},_callee10,this)}));return function(_x7){return _create2.apply(this,arguments)}}()},{key:"_createFromName",value:function(){var _createFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee11(name){var payload,_args11=arguments;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return payload=_args11.length>1&&void 0!==_args11[1]?_args11[1]:{},QueryParams.a.has("session_extra")&&(payload=JSON.parse(QueryParams.a.get("session_extra"))),_context11.abrupt("return",this._create({name:name,payload:payload}));case 3:case"end":return _context11.stop()}},_callee11,this)}));return function(_x8){return _createFromName2.apply(this,arguments)}}()},{key:"_createDistinctFromName",value:function(){var _createDistinctFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee12(name){var date;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return this.sessions.find(function(s){return s.name==name})&&(date=new Date,name="".concat(name," ").concat(date.getHours(),":").concat(date.getMinutes())),_context12.abrupt("return",this._createFromName(name));case 2:case"end":return _context12.stop()}},_callee12,this)}));return function(_x9){return _createDistinctFromName2.apply(this,arguments)}}()}]),Offline}()},SessionDrivers={getDriver:function(){var mode=QueryParams.a.get("mode");return new(0,AVAILABLE_DRIVERS[mode||"offline"])}};function SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function SessionManager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function SessionManager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var sessions_SessionManager=new(function(){function SessionManager(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SessionManager),this.driver=SessionDrivers.getDriver()}return function(Constructor,protoProps,staticProps){protoProps&&SessionManager_defineProperties(Constructor.prototype,protoProps),staticProps&&SessionManager_defineProperties(Constructor,staticProps)}(SessionManager,[{key:"start",value:function(){var _start=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.driver.start();case 2:this.session=_context.sent;case 3:case"end":return _context.stop()}},_callee,this)}));return function(){return _start.apply(this,arguments)}}()},{key:"attachmentUrl",value:function(){var _attachmentUrl=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee2(fileName){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.driver.attachmentUrl(this.session,fileName);case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(_x){return _attachmentUrl.apply(this,arguments)}}()},{key:"finalize",value:function(){var _finalize=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee3(form){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!this.driver.canSave()){_context3.next=5;break}return _context3.next=3,this.save(form);case 3:_context3.next=6;break;case 5:this.session.writeEnketoForm(form);case 6:return _context3.next=8,this.driver.finalize(this.session);case 8:case"end":return _context3.stop()}},_callee3,this)}));return function(_x2){return _finalize.apply(this,arguments)}}()},{key:"save",value:function(){var _save=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee4(form){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this.driver.canSave()){_context4.next=2;break}return _context4.abrupt("return",Promise.resolve(!0));case 2:return this.session.writeEnketoForm(form),_context4.next=5,this.driver.save(this.session);case 5:this.session=_context4.sent;case 6:case"end":return _context4.stop()}},_callee4,this)}));return function(_x3){return _save.apply(this,arguments)}}()}]),SessionManager}()),fileManager=__webpack_require__(118),originalGetFileUrl=fileManager.getFileUrl;fileManager.getFileUrl=function(subject){return subject&&"string"==typeof subject?sessions_SessionManager.attachmentUrl(subject):originalGetFileUrl(subject)};var file_manager=fileManager;function SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function SurveyManager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function SurveyManager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var survey_SurveyManager=new(function(){function SurveyManager(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SurveyManager)}return function(Constructor,protoProps,staticProps){protoProps&&SurveyManager_defineProperties(Constructor.prototype,protoProps),staticProps&&SurveyManager_defineProperties(Constructor,staticProps)}(SurveyManager,[{key:"loadAndAttach",value:function(){var _loadAndAttach=SurveyManager_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this._load();case 2:this._preprocessFormHtml(),this._attachSurveyFormToDom();case 4:case"end":return _context.stop()}},_callee,this)}));return function(){return _loadAndAttach.apply(this,arguments)}}()},{key:"_load",value:function(){var _load2=SurveyManager_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Server.a.create().json(QueryParams.a.getPath("survey"));case 2:this.survey=_context2.sent;case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _load2.apply(this,arguments)}}()},{key:"_preprocessFormHtml",value:function(){this.survey.form=this.survey.form.replace(/jr:\/\/images\//g,QueryParams.a.getPath("assets")+"/")}},{key:"_attachSurveyFormToDom",value:function(){document.querySelector(".form-header").insertAdjacentHTML("afterend",this.survey.form),this._hideSurveyTitle()}},{key:"_hideSurveyTitle",value:function(){"off"===QueryParams.a.get("title")&&document.getElementById("form-title").remove()}}]),SurveyManager}());function EnketoForm_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function EnketoForm_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function EnketoForm_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Form=__webpack_require__(419),EnketoForm_emitter=__webpack_require__(42),makeEmitter=function(silent){return silent?function(e){}:function(e){return EnketoForm_emitter.emit(e)}},survey_EnketoForm=new(function(){function EnketoForm(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EnketoForm)}return function(Constructor,protoProps,staticProps){protoProps&&EnketoForm_defineProperties(Constructor.prototype,protoProps),staticProps&&EnketoForm_defineProperties(Constructor,staticProps)}(EnketoForm,[{key:"init",value:function(){var _init=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.saving=!1,this.validating=!1,_context.next=4,survey_SurveyManager.loadAndAttach();case 4:return _context.next=6,sessions_SessionManager.start();case 6:this._newFormInstance(),this._initFormInstance(),this._localizeForm(),EnketoForm_emitter.emit("EnketoForm.initialized");case 10:case"end":return _context.stop()}},_callee,this)}));return function(){return _init.apply(this,arguments)}}()},{key:"_newFormInstance",value:function(){this.form=new Form("form.or:eq(0)",function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){EnketoForm_defineProperty(target,key,source[key])})}return target}({modelStr:survey_SurveyManager.survey.model},sessions_SessionManager.session.toFormInstance()))}},{key:"_initFormInstance",value:function(){var loadErrors=this.form.init();if(loadErrors.length)throw console.error(loadErrors),new Error("The form could not be initialized")}},{key:"_localizeForm",value:function(){QueryParams.a.has("lang")&&i18n.set(QueryParams.a.get("lang"));var lang=i18n.get();this.form.langs.setAll(lang)}},{key:"save",value:function(){var _save=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!this.saving){_context2.next=2;break}return _context2.abrupt("return",null);case 2:return this.saving=!0,EnketoForm_emitter.emit("EnketoForm.saving"),_context2.prev=4,_context2.next=7,this._saveSession();case 7:_context2.next=14;break;case 9:throw _context2.prev=9,_context2.t0=_context2.catch(4),this.saving=!1,EnketoForm_emitter.emit("EnketoForm.saveFailed"),_context2.t0;case 14:this.saving=!1,EnketoForm_emitter.emit("EnketoForm.saveSucceded");case 16:case"end":return _context2.stop()}},_callee2,this,[[4,9]])}));return function(){return _save.apply(this,arguments)}}()},{key:"_saveSession",value:function(){var _saveSession2=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.t0=sessions_SessionManager,_context3.next=3,this._form();case 3:return _context3.t1=_context3.sent,_context3.next=6,_context3.t0.save.call(_context3.t0,_context3.t1);case 6:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _saveSession2.apply(this,arguments)}}()},{key:"_form",value:function(){var _form2=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.t0=this.form.getDataStr(),_context4.next=3,this._formFiles();case 3:return _context4.t1=_context4.sent,_context4.t2=this.form.instanceID,_context4.t3=this.form.deprecatedID,_context4.abrupt("return",{xml:_context4.t0,files:_context4.t1,instance_id:_context4.t2,deprecated_id:_context4.t3});case 7:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _form2.apply(this,arguments)}}()},{key:"_formFiles",value:function(){var files=file_manager.getCurrentFiles();return $('form.or input[type="file"][data-loaded-file-name]').each(function(){files.push($(this).data("loaded-file-name"))}),files}},{key:"_validateForm",value:function(){return QueryParams.a.has("novalidate")?Promise.resolve(!0):this.form.validate()}},{key:"validate",value:function(){var _validate=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var silent,emitEvent,outcome,_args5=arguments;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(silent=_args5.length>0&&void 0!==_args5[0]&&_args5[0],!this.validating){_context5.next=3;break}return _context5.abrupt("return");case 3:return emitEvent=makeEmitter(silent),this.validating=!0,emitEvent("EnketoForm.validating"),_context5.next=8,this._validateForm();case 8:return outcome=_context5.sent,emitEvent(outcome?"EnketoForm.validationSucceeded":"EnketoForm.validationFailed"),this.validating=!1,_context5.abrupt("return",outcome);case 12:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _validate.apply(this,arguments)}}()},{key:"finishAndSubmit",value:function(){var _finishAndSubmit=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var silent;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return silent=!0,_context6.next=3,this.validate(silent);case 3:if(_context6.sent){_context6.next=5;break}throw new Error("Form cannot be submitted. Check validation errors!");case 5:return _context6.prev=5,_context6.t0=sessions_SessionManager,_context6.next=9,this._form();case 9:return _context6.t1=_context6.sent,_context6.next=12,_context6.t0.finalize.call(_context6.t0,_context6.t1);case 12:_context6.next=18;break;case 14:throw _context6.prev=14,_context6.t2=_context6.catch(5),EnketoForm_emitter.emit("EnketoForm.submitFailed",_context6.t2),_context6.t2;case 18:case"end":return _context6.stop()}},_callee6,this,[[5,14]])}));return function(){return _finishAndSubmit.apply(this,arguments)}}()}]),EnketoForm}());function Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Kernel_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Kernel_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__(42);var survey_Kernel=new(function(){function Kernel(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Kernel),this.saving=!1,this.validating=!1}return function(Constructor,protoProps,staticProps){protoProps&&Kernel_defineProperties(Constructor.prototype,protoProps),staticProps&&Kernel_defineProperties(Constructor,staticProps)}(Kernel,[{key:"boot",value:function(){var _boot=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:survey_EnketoForm.init();case 1:case"end":return _context.stop()}},_callee,this)}));return function(){return _boot.apply(this,arguments)}}()},{key:"submit",value:function(){var _submit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",survey_EnketoForm.finishAndSubmit().then(function(_){return _this.exit()}));case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _submit.apply(this,arguments)}}()},{key:"_save",value:function(){var _save2=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,survey_EnketoForm.save();case 2:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _save2.apply(this,arguments)}}()},{key:"exit",value:function(){var _exit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!QueryParams.a.has("return")){_context4.next=2;break}return _context4.abrupt("return",window.location=QueryParams.a.getPath("return"));case 2:window.location="index.html";case 3:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _exit.apply(this,arguments)}}()},{key:"saveAndExit",value:function(){var _saveAndExit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this._save();case 2:return _context5.next=4,this.exit();case 4:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _saveAndExit.apply(this,arguments)}}()}]),Kernel}());$(document).ready(function(){$(".save-progress").click(function(){survey_EnketoForm.save()}),$("#close-button").click(function(){survey_Kernel.saveAndExit()}),$(".validate-form").on("click",function(){survey_EnketoForm.validate()}),$(".first-page-alias").click(function(){$(".first-page").click()}),$(".last-page-alias").click(function(){$(".last-page").click()}),$(".submit-form").on("click",function(){var $self=$(this);return $self.attr("disabled","disabled"),survey_Kernel.submit().catch(function(e){console.error(e),$self.removeAttr("disabled")}),!1})});var Overlays_emitter=__webpack_require__(42);$(document).ready(function(){return Overlays_setBackgroundImage()}),Overlays_emitter.once("EnketoForm.initialized",function(){return Overlays_showSurvey()}),Overlays_emitter.on("EnketoForm.saving",function(){return saving()}),Overlays_emitter.on("EnketoForm.saveFailed",function(){return saveFailed()}),Overlays_emitter.on("EnketoForm.saveSucceded",function(){return saveSucceded()}),Overlays_emitter.on("EnketoForm.validating",function(){return validating()}),Overlays_emitter.on("EnketoForm.validationFailed",function(){return validationFailed()}),Overlays_emitter.on("EnketoForm.validationSucceeded",function(){return validationSucceeded()}),Overlays_emitter.on("EnketoForm.submitting",function(){return submitting()}),Overlays_emitter.on("EnketoForm.submitFailed",function(e){return Overlays_submitFailed(e)}),Overlays_emitter.on("EnketoForm.submitSucceeded",function(){return submitSucceeded()}),Overlays_emitter.on("EnketoForm.submit.status",function(status){return submitStatus(status)});var Overlays_setBackgroundImage=function(){if(QueryParams.a.has("bg")){var style="content: ' ';display: block;position: absolute;top: 0;left: 0;width: 100%;height: 100%;opacity: 0.2;z-index: -1;background-image: url('"+QueryParams.a.get("bg")+"');background-size: cover;background-position: center;background-repeat: no-repeat;";$("<style>#loading-block:after { "+style+"} </style>").appendTo("head")}},Overlays_showSurvey=function(){sessions_SessionManager.driver.canSave()||document.querySelector(".save-progress").remove(),document.querySelector(".form-header").style.display="block",document.querySelector("#submit-progress").style.display="none",document.querySelector("#loading-block").remove(),window.scrollTo(0,0)},saving=function(){var $saveProgress=$(".save-progress");$saveProgress.html('<i class="fa fa-spinner fa-spin"></i>'),$saveProgress.attr("disabled","disabled")},Overlays_finishSaving=function(outcome,message){var $saveProgress=$(".save-progress");$saveProgress.html('<i class="fa fa-save"></i>'),$saveProgress.removeAttr("disabled","disabled"),message&&toastr_default.a[outcome](message)},saveFailed=function(){Overlays_finishSaving("error","An error occured while saving this sesssion...")},saveSucceded=function(){Overlays_finishSaving("success",i18n._("survey.saved"))},validating=function(){$(".submit-form").data("original-content",$(".submit-form").text()).attr("disabled","disabled").text("Validating...")},Overlays_finishValidating=function(outcome,message){$(".submit-form").removeAttr("disabled").text($(".submit-form").data("original-content")),toastr_default.a[outcome](message)},validationFailed=function(){Overlays_finishValidating("error","The form contains validation errors.")},validationSucceeded=function(){Overlays_finishValidating("success","The data looks valid!"),$(".last-page").click()},submitting=function(){$("#submit-progress").overlay("show")},Overlays_submitFailed=function(e){$("#submit-progress").overlay("hide"),toastr_default.a.error("Submission failed","string"==typeof e?e:e.toString())},submitStatus=function(_submitStatus){$("#submit-progress-text").html(_submitStatus)},SessionModal_emitter=__webpack_require__(42),SessionModal_app=angular_default.a.module("sessionModal",[]);SessionModal_app.filter("timeAgo",function(){return function(value){return new Date(value).toLocaleString()}}),SessionModal_app.controller("Controller",function($scope){$scope.form={name:""},$scope.show=!1,$scope.sessions=[],$scope.disableCreateButton=!1,SessionModal_emitter.on("SessionModal.activate",function(){return $scope.$apply(function(){$scope.show=!0})}),SessionModal_emitter.on("SessionModal.updateSessions",function(sessions){return $scope.$apply(function(){$scope.sessions=sessions})}),$scope.createSession=function(){var name=$scope.form.name.trim();if(!name)return $scope.name="",alert("Please enter a session name");$scope.show=!1,$scope.disableCreateButton=!0,SessionModal_emitter.emit("Session.create",name)},$scope.delete=function(session){confirm("Do you really want to delete this session? DATA WILL BE LOST!")&&SessionModal_emitter.emit("Session.delete",session)},$scope.select=function(session){$scope.show=!1,SessionModal_emitter.emit("Session.select",session)}}),angular_default.a.bootstrap(document.getElementById("sessionModal"),["sessionModal"]),toastr_default.a.options={positionClass:"toast-top-left"},survey_Kernel.boot()},82:function(module,exports,__webpack_require__){var lodashSet=__webpack_require__(155);module.exports={get:function(obj,path,def){return path.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean).every(function(step){return!(step&&void 0===(obj=obj[step]))})?obj:def},set:lodashSet}}},[[466,1,0]]])});